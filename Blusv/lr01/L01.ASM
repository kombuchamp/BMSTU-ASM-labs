;1. HАБРАТЬ ПРОГРАММУ И ДАТЬ ЕЙ ИМЯ LAB1.ASM
;  ******************************
;  *   Лабораторная работа N1   *
;  *   ----------------------   *
;  *   Изучение отладчика AFD   *
;  ******************************
;  ------------------------------
; Программа.: DispMsg
; Дата......: 02/04/90 10:25am
; Примечание: Программа выводит на дисплей сообщение и
;             и ожидает  нажатия клавиши , код символа
;             помещается в регистр AL
; Справка...: DS:DX - адрес строки;
;             Функции DOS :
;             09h выдать на дисплей строку,
;             07h ввести символ без эха,
;             4Ch завершить процесс ;
;             INT   21h - вызов  функции DOS
;
StkSeg  SEGMENT PARA STACK 'STACK'
        DB      200h DUP (?)

StkSeg  ENDS
;
DataS   SEGMENT WORD 'DATA'
HelloMessage    DB   13                ;курсор поместить в нач. строки
                DB   10                ;перевести курсор на нов. строку
                DB   'Hello, world !'  ;текст сообщения
                DB   '$'               ;ограничитель для функции DOS
DataS   ENDS
;
Code    SEGMENT WORD 'CODE'
        ASSUME  CS:Code, DS:DataS
DispMsg:
        mov   AX,DataS                 ;загрузка в AX адреса сегмента данных
        mov   DS,AX                    ;установка DS
        mov   DX,OFFSET HelloMessage   ;DS:DX - адрес строки
        mov   AH,9                     ;АН=09h выдать на дисплей строку
        int   21h                      ;вызов  функции DOS
        mov   AH,7                     ;АН=07h ввести символ без эха
        INT   21h                      ;вызов  функции DOS
        mov   AH,4Ch                   ;АН=4Ch завершить процесс
        int   21h                      ;вызов  функции DOS
Code    ENDS
        END   DispMsg

2. ТРАНСЛИРОВАТЬ ПРОГРАММУ. НАБРАТЬ:  >MASM LAB1.ASM
3. СОЗДАТЬ ИСПОЛНЯЕМЫЙ ФАЙЛ. НАБРАТЬ:  >LINK LAB1.OBJ
4. ВЫПОЛНИТЬ ПРОГРАММУ ПОД УПРАВЛЕНИЕМ ОТЛАДЧИКА AFD
  Отладчик  AFD  позволяет программисту проверять и модифицировать :
        а) необработанные шестнадцатеричные данные,
        б) содержимое стека,
        в) содержимое регистров процессора,
        г) состояние флагов процессора.
  После старта программы AFD на экране появляются 7 окон :
        Верхний ряд : левое   - регистры процессора,
                      среднее - стек,
                      правое  - флаги.
        Средний ряд : левое верхнее - окно команд отладчика,
                      левое нижнее  - окно кода программы,
                      правое        - окно данных.
        Нижний ряд:   oкно данных, которое отображает выбранную область
                      памяти в двух форматах : шестнадцатеричном и
                        символьном
 

   Нижняя строка экрана предназначена для управления режимом
   работы отладчика с помощью функциональной клавиатуры :
        F1       - пошаговый режим   (шаг - команда),
        F2       - процедурный режим (шаг - процедура),
        F3       - просмотр буфера команд отладчика,
        F4       - включение/выключение подсказки,
        F5       - вызов меню обработки точек прерывания,
        F7 - F10 - выбор активного окна.
   Управление работой отладчика может осуществляться с помощью команд :
                   Команды отладчика AFD
___________________________________________________________________
              Команда                   Действие
___________________________________________________________________
 ?  {%}= выражение              калькулятор (? %= десятичный тип)
 D  адрес                       выдать код, начиная с данного адреса
 F  адрес,длина,значение        заполнить область памяти значением
 G  {адрес_нач.},{адрес_прер.}  выполнить программу
 GC {адрес_нач.},{адрес_прер.}  продолжить выполнение программы без
                                сброса счетчика прерываний
 L  {/адрес} имя_файла {парам}  загрузить из файла
 PT {/S} {номер_нач.,колич.{,имя_файла}}
                                вывод содержимого буфера трассировки
 QUIT                           прекратить отладку
 S  {{адрес},строка}            искать строку, начиная с адреса
 SI {{адрес},команда}           искать команду, начиная с адреса
 TR {ON|OFF} {CLR}              управление трассировкой
 W  {адрес,длина,имя_файла}     записать область памяти в файл
___________________________________________________________________
   1) Вызвать AFD, набрав в командной строке AFDPRO.
   2) Загрузить и выполнить программу.
   3) Загрузить и выполнить программу в пошаговом режиме (F2).
   4) Загрузить программу и выполнить установку регистра DS.
   5) Записать 16 байт, начиная с адреса HelloMessage в файл.
   6) Выйти из AFD.
   7) Выдать на экран файл, записанный в п.5.
   8) Повторить пп 3-6, изменив с помощью отладчика текст сообщения.
   9) Загрузить и выполнить программу, проверяя содержимое регистров
      при каждом обращении к функциям DOS (использовать команды G и SI).
5. ВЫПОЛНИТЬ ПРОГРАММУ С УСТАНОВКОЙ ТОЧЕК ПРЕРЫВАНИЯ
   Описание меню обработки точек прерывания :
        F1       - просмотр трассировки программы,
        F3       - загрузить настройку точек прерывания,
        F4       - включение/выключение подсказки,
        F5       - возврат в командный режим,
        F7       - сохранить настройку точек прерывания,
        F9       - сбросить настройку точек прерывания,
        F10      - сбросить счетчик.
   Для настройки каждой точки прерывания необходимо установить :
   адрес, условие, количество, ответное действие (S - сохранить
   содержимое регистров, B - прервать выполнение программы).

   1) Вызвать AFD.
   2) Установить точки прерывания :
         а) для проверки содержимого строки перед выводом на экран,
         б) для проверки кода символа, введенного с клавиатуры (регистр AL).
         в) для проверки наличия кода перевода курсора (ASCII код 13) .
   3) Выполнить программу.
   4) Проверить содержимое области памяти, начиная с адреса HelloMessage.
   5) Определите символ введенный с клавиатуры.
   6) Сохранить настройку точек прерывания.
   7) Сбросить настройку точек прерывания.
   8) Загрузить настройку точек прерывания.
   9) Сохранить содержимое регистров для п.2б в файле CODE.KEY
  10) Выйти из AFD.
  11) Выдать на экран файл, записанный в п.9.
 
